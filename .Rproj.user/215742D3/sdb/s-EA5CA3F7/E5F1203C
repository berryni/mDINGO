{
    "collab_server" : "",
    "contents" : "scoring.boot.parallel <- function(stddat,z,Omega,A,B,boot.B=100,verbose=T,cores) {\n    ## stddat <- standardized nxp data with colnames as genename\n    ## z <- covariate indicator (should be binary)\n    ## Omega <- precision matrix for whole data (implies global network)\n    ## A <- MLE of the baseline covariance matrix\n    ## B <- MLE of the regression coefficients\n    ## boot.B <- number of bootstrap samples\n    ## cores <- number of cores to use \n    \n    p = ncol(stddat)\n    n = nrow(stddat)\n    w.upper = which(upper.tri(Omega))\n    w.mat = which(upper.tri(Omega),arr.ind=T)\n    II = diag(p)\n    levels.z = unique(z)\n    \n    stopifnot(length(levels.z)==2)\n    \n    # make global component from Omega\n    diag.Omega = diag(Omega)\n    P = -Omega/diag.Omega\n    diag(P) = 0\n    \n    # data transformation\n    tY.org = stddat %*% (II-t(P))\n    \n    cl <- makeCluster(cores)\n    \n    #environment(single.boot) <- .GlobalEnv\n    #environment(Greg.em) <- .GlobalEnv\n    #environment(trans.Fisher) <- .GlobalEnv\n    #environment(scaledMat) <- .GlobalEnv\n    \n    clusterExport(cl, list(\"single.boot\", \"Greg.em\", \"trans.Fisher\", \"scaledMat\", \"Sigmax\"))\n    \n    # run bootstraps    \n    boot.diff <-  parSapply(cl, 1:boot.B, single.boot, \n                            z=z, n=n, tY.org=tY.org, P=P, levels.z=levels.z, w.upper=w.upper)\n    \n    stopCluster(cl)\n\n    # differential scoring\n    genepair = data.frame(gene1 = colnames(stddat)[w.mat[,1]],gene2 =colnames(stddat)[w.mat[,2]])\n    R1 = -scaledMat(solve(Sigmax(Q=B,P=P,Psi=A,x=c(1,levels.z[1]))))[w.upper]\n    R2 = -scaledMat(solve(Sigmax(Q=B,P=P,Psi=A,x=c(1,levels.z[2]))))[w.upper]\n    \n    diff.score = (trans.Fisher(R1) - trans.Fisher(R2)) / apply(boot.diff,1,sd)\n\n    return(list(genepair=genepair,levels.z=levels.z,R1=R1, R2=R2, boot.diff=boot.diff,diff.score=diff.score))\n}\n",
    "created" : 1483565088998.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "620676159",
    "id" : "E5F1203C",
    "lastKnownWriteTime" : 1485201224,
    "last_content_update" : 0,
    "path" : "Y:/R/win-library/3.1/DINGOparallel/R/scoring.boot.parallel.R",
    "project_path" : "R/scoring.boot.parallel.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}